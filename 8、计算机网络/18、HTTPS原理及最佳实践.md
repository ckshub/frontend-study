# HTTPS简介
![](./img/18、HTTPS原理以及最佳时间/HTTPS交互流程.jpg)

- HTTPS = HTTP + TLS(SSL)
- TLS是SSL经过组织协议之后的版本。TLS目前包括TLS1.2（2008年更新）TLS1.3（2018年更新）
- TLS1.2需要2个rtt，TLS1.3需要0个rtt，极大的加快了速度。

## HTTP为什么需要握手？
1. 身份认证-防冒充
2. 数据加密-防窃听
3. 数据防篡改-防篡改
 
## 身份认证-证书
![](./img/18、HTTPS原理以及最佳时间/HTTPS证书的作用.jpg)
![](./img/18、HTTPS原理以及最佳时间/数字签名.jpg)

### 作用
1. 校验签名
2. 传递公钥


### 非对称加密
公钥加密，私钥解密。
客户端发送证书 =》 携带公钥A、证书 =》 服务器
服务器 =》 通过公钥A加密一个数据a，校验证书 =》 客户端
客户端 =》 通过私钥解密数据a
# 流量劫持和监控
> HTTPS是解决链路劫持的核武器！

### DNS劫持（域名劫持）
   1. 可以通过检测证书判断是否安全。然后有两种方案：硬拒绝和软拒绝

### 不能解决的问题
1. 客户端木马、问题
2. 只能处理在传输层的问题
3. 中间人攻击也没办法

# HTTPS性能优化
## HTTPS存在的问题
> 为什么现在还有54%不支持HTTPS？
## 慢
1. 移动端慢500ms以上

### TCP协议优化
- fast open
![](./img/18、HTTPS原理以及最佳时间/TCP优化方案.jpg)

### 应用层协议优化
1. HSTS减少302跳转
![](./img/18、HTTPS原理以及最佳时间/HSTS.jpg)

2. 采用HTTP2.0
   1. HTTP1.x是串行链路。
   2. HTTP2.0支持【多路复用】、【头部压缩】、【server push】

### 密钥计算加速
1. RSA算法对整体性能影响75%
2. 优化方案（减少完全握手）
   1. 分布式session cache
   2. 全局session ticket
   3. 自定义session ticket
3. RSA异步代理计算
### 
## 贵
1. 服务器成本：HTTPS性能不到HTTP 1/10
2. 证书：价格不一、容易过期、申请复杂

# HTTPS证书和部署问题